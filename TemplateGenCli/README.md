# TemplateGenCli

> 此项目代码由AI协助开发完成 | This project was developed with AI assistance

一个基于实体类的C#代码生成器CLI工具，自动生成Repository、Service、Mapster配置等模板代码，减少重复性工作和手动文件操作。

A C# CLI code generator tool based on entity classes that automatically generates Repository, Service, Mapster configuration template code, reducing repetitive work and manual file operations.

---

## 功能特性 | Features

- 🚀 **自动代码生成 | Auto Code Generation** - 基于实体类自动生成Repository、Service、Mapster配置 | Automatically generate Repository, Service, Mapster configurations based on entity classes
- ⚙️ **配置驱动 | Configuration Driven** - 通过appsettings.json灵活配置生成规则 | Flexible generation rules via appsettings.json
- 🏗️ **可扩展架构 | Extensible Architecture** - 支持添加新的代码生成器类型 | Support for adding new code generator types
- 📁 **批量处理 | Batch Processing** - 一次性处理整个实体文件夹 | Process entire entity folders at once
- 🔧 **依赖注入集成 | DI Integration** - 自动注入生成的类到DI容器 | Automatically inject generated classes into DI container

## 支持的生成器类型 | Supported Generator Types

1. **Mapster配置生成器 | Mapster Config Generator** - 生成TypeAdapter映射配置 | Generate TypeAdapter mapping configurations
2. **Repository生成器 | Repository Generator** - 生成仓储接口和实现 | Generate repository interfaces and implementations
3. **Service生成器 | Service Generator** - 生成服务接口和实现 | Generate service interfaces and implementations

---

## 快速开始 | Quick Start

### 1. 发布工具到项目 | Deploy Tool to Project

```bash
# 将TemplateGenCli.exe复制到你的项目根目录
# Copy TemplateGenCli.exe to your project root directory
```

### 2. 配置appsettings.json | Configure appsettings.json

```json
{
    "CodeGenConfig": {
        "entityConfig": {
            "path": "..\\..\\Entities",
            "namespace": "YourProject.Entities",
            "exceptEntities": ["Log", "Audit"]
        },
        "mapsterConfig": {
            "enable": true,
            "namespace": "YourProject.Mappings",
            "configFile": "Config\\MapsterConfig.cs",
            "outputPath": "Generated\\Mappings",
            "startMark": "// <auto-generated start>",
            "endMark": "// <auto-generated end>"
        },
        "serviceConfig": {
            "enable": true,
            "outputPath": "Generated\\Services",
            "namespace": "YourProject.Services",
            "interfaceOutput": "Interfaces\\Services",
            "interfaceNamespace": "YourProject.Interfaces.Services",
            "startMark": "// <service-injection start>",
            "endMark": "// <service-injection end>",
            "diFilePath": "Config\\ServiceRegistration.cs"
        },
        "repositoryConfig": {
            "enable": true,
            "outputPath": "Generated\\Repositories",
            "namespace": "YourProject.Repositories",
            "persistenceNamespace": "YourProject.Data",
            "dbContext": "AppDbContext",
            "interfaceOutput": "Interfaces\\Repositories",
            "interfaceNamespace": "YourProject.Interfaces.Repositories",
            "startMark": "// <repository-injection start>",
            "endMark": "// <repository-injection end>",
            "diFilePath": "Config\\RepositoryRegistration.cs"
        }
    }
}
```

### 3. 运行生成器 | Run Generator

```bash
./TemplateGenCli.exe
```

---

## 配置详解 | Configuration Details

### EntityConfig
- **path** - 实体类文件路径 | Entity class file path
- **namespace** - 实体类命名空间 | Entity class namespace
- **exceptEntities** - 排除的实体类名称列表 | List of entity names to exclude

### MapsterConfig
- **enable** - 是否启用Mapster配置生成 | Whether to enable Mapster config generation
- **namespace** - 生成的Mapster配置类命名空间 | Namespace for generated Mapster config classes
- **configFile** - Mapster配置文件路径（用于注入） | Mapster config file path (for injection)
- **outputPath** - 输出目录 | Output directory
- **startMark/endMark** - 自动生成代码的标记 | Markers for auto-generated code

### ServiceConfig & RepositoryConfig
类似结构，支持接口和实现的分离生成，以及DI注册。
Similar structure, supporting separate generation of interfaces and implementations, as well as DI registration.

---

## 扩展开发 | Extension Development

### 添加新的生成器类型 | Adding New Generator Types

#### 1. 创建生成器枚举 | Create Generator Enum
```csharp
public enum GeneratorType
{
    Repository,
    Service,
    Mapster,
    YourNewGenerator  // 添加新类型 | Add new type
}
```

#### 2. 实现IGenerator接口 | Implement IGenerator Interface
```csharp
public class YourNewGenerator : IGenerator
{
    public void Run(IGeneratorConfig config, GeneratorContext context)
    {
        // 实现你的生成逻辑 | Implement your generation logic
    }
}
```

#### 3. 更新工厂类 | Update Factory Class
```csharp
public static IGenerator? Create(GeneratorType type)
{
    return type switch
    {
        GeneratorType.YourNewGenerator => new YourNewGenerator(),
        // ... 其他类型 | other types
        _ => null
    };
}
```

### GeneratorContext的作用 | Role of GeneratorContext

`GeneratorContext`是生成器之间共享数据的上下文对象：
`GeneratorContext` is a context object for sharing data between generators:

- **EntityConfig** - 包含实体配置信息 | Contains entity configuration information
- **可扩展性 | Extensibility** - 可添加更多共享数据（如解析的实体元数据） | Can add more shared data (such as parsed entity metadata)

```csharp
public class GeneratorContext
{
    public EntityConfig EntityConfig { get; }
    // 可以添加更多共享数据 | Can add more shared data
    public Dictionary<string, EntityMetadata> EntityMetadata { get; set; }
    
    public GeneratorContext(EntityConfig entityConfig)
    {
        EntityConfig = entityConfig;
    }
}
```

### CodeGenConfig说明 | CodeGenConfig Description

`CodeGenConfig`是主配置类，通过appsettings.json绑定：
`CodeGenConfig` is the main configuration class, bound through appsettings.json:

```csharp
public class CodeGenConfig
{
    public EntityConfig EntityConfig { get; set; }
    public MapsterConfig MapsterConfig { get; set; }
    public ServiceConfig ServiceConfig { get; set; }
    public RepositoryConfig RepositoryConfig { get; set; }
}
```

---

## 未来规划 | Future Plans

- [ ] 支持指定实体生成 | Support specific entity generation：`./TemplateGenCli.exe -entity User,Product`
- [ ] 支持CRUD模板生成 | Support CRUD template generation
- [ ] 支持自定义模板文件 | Support custom template files
- [ ] 支持更多ORM框架 | Support more ORM frameworks

## 贡献指南 | Contributing

欢迎提交Pull Request来：
Welcome to submit Pull Requests to:

- 添加新的生成器类型 | Add new generator types
- 改进现有模板 | Improve existing templates  
- 添加新功能 | Add new features
- 修复Bug | Fix bugs

## 注意事项 | Notes

1. 确保实体类文件路径正确 | Ensure entity class file paths are correct
2. 生成前请备份现有代码 | Please backup existing code before generation
3. 检查生成的代码是否符合项目规范 | Check if generated code meets project standards
4. 暂不支持指定单个实体生成（可通过排除列表间接实现） | Currently does not support generating specific entities (can be achieved indirectly through exclusion list)

---

*Happy Coding! 🚀*